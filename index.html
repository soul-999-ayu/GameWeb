<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> - Gaming Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-neon': '#4ade80', // Green Neon
                        'secondary-glow': '#00ffff', // Electric Cyan
                        'dark-bg': '#0f172a', // Slate Blue Dark
                        'card-bg': 'rgba(15, 23, 42, 0.8)', // Semi-transparent Slate 900
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    keyframes: {
                        'glow': {
                            '0%, 100%': { filter: 'drop-shadow(0 0 4px #4ade80)' },
                            '50%': { filter: 'drop-shadow(0 0 8px #00ffff)' },
                        },
                    },
                    animation: { 'pulse-glow': 'glow 3s infinite ease-in-out' }
                }
            }
        }
    </script>
    <style>
        /* BACKGROUND & SCROLL FIXES */
        #background-layer {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1; 
            background: url('resources/images/background/bg.png') no-repeat center center;
            background-size: cover;
            -webkit-backdrop-filter: blur(3px); backdrop-filter: blur(3px);
            background-color: rgba(0, 0, 0, 0.75); background-blend-mode: multiply;
        }

        body { margin: 0; padding: 0; min-height: 100vh; width: 100vw; overflow-x: hidden; }

        /* CARD STYLES */
        .glass-card {
            background-color: var(--card-bg);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 255, 255, 0.15); 
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .glass-card:hover { transform: translateY(-5px); box-shadow: 0 12px 40px 0 rgba(0, 255, 255, 0.3); }

        /* TAB BUTTONS */
        .tab-button {
            position: relative; font-weight: bold; text-transform: uppercase;
            padding: 0.75rem 2.5rem; color: #ccc; border-bottom: 2px solid transparent;
            transition: all 0.2s; cursor: pointer;
        }
        .tab-button.active {
            color: #ffc400; border-bottom-color: #ffc400; 
            box-shadow: 0 2px 5px rgba(255, 196, 0, 0.5);
        }
        
        /* GAME TEXT POP */
        .game-title-pop {
            font-size: 1.3rem; text-shadow: 0 0 5px rgba(255, 196, 0, 0.8);
            color: #ffc400; display: block; text-decoration: none; 
        }
        
        /* MODAL POSITIONING */
        .modal-card-centered {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%); z-index: 55;
        }
        .modal-backdrop {
            position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.7);
            z-index: 50; transition: opacity 0.3s; opacity: 0; pointer-events: none;
        }
        .modal-backdrop.open { opacity: 1; pointer-events: auto; }
    </style>
</head>
<body class="font-sans text-white">

    <div id="background-layer"></div>

    <div id="app" class="p-4 md:p-8 relative z-0 min-h-screen flex flex-col">
        <header class="flex justify-between items-center mb-12 glass-card rounded-xl p-4 md:p-6 sticky top-0 z-10">
            <h1 id="siteTitle" class="text-2xl sm:text-3xl md:text-4xl font-extrabold text-primary-neon animate-pulse-glow tracking-wider uppercase cursor-pointer" onclick="navigateTo('home')">
                </h1>
            
            <div class="flex space-x-2 sm:space-x-4 items-center relative">
                <button id="adminBtn" onclick="navigateTo('admin')" class="bg-red-500 text-white text-sm sm:text-base font-bold py-2 px-4 sm:px-6 rounded-lg hidden">ADMIN</button>
                
                <button id="getInBtn" onclick="handleGetIn()" class="bg-secondary-glow text-dark-bg text-sm sm:text-base font-bold py-2 px-4 sm:px-6 rounded-lg hover:scale-105 transition">GET IN</button>

                <div id="userProfile" class="hidden flex flex-col items-center cursor-pointer relative z-50 ml-2" onclick="toggleLogoutMenu()">
                    <img src="https://github.com/soul-999-ayu/GameWeb/blob/main/resources/images/other/gamer.png?raw=true" 
                         alt="User" 
                         class="w-10 h-10 rounded-full border-2 border-secondary-glow shadow-[0_0_10px_#00ffff] hover:scale-110 transition object-cover bg-black">
                    <span id="displayUsername" class="text-[10px] sm:text-xs text-secondary-glow font-bold mt-1 tracking-wider uppercase max-w-[80px] truncate">User</span>
                    
                    <div id="logoutMenu" class="hidden absolute top-14 right-0 bg-dark-bg/95 backdrop-blur-md border border-secondary-glow/30 rounded-lg shadow-[0_0_15px_rgba(0,0,0,0.5)] p-2 w-36 mt-2">
                        <button onclick="handleLogout(event)" class="w-full text-left text-red-400 hover:text-red-300 hover:bg-white/10 font-bold text-sm py-2 px-3 rounded transition flex items-center">
                            <i class="fa-solid fa-power-off mr-2"></i> LOGOUT
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <main id="mainContent" class="max-w-7xl mx-auto flex-grow w-full">
            </main>

        <footer class="mt-20 pt-8 border-t border-secondary-glow/20 text-center text-gray-400">
            <p id="footer-copy">&copy; 2025 . Game data simulated.</p>
        </footer>
    </div>

    <div id="modalBackdrop" class="modal-backdrop"></div>

    <div id="getInChoiceModal" class="glass-card rounded-2xl p-8 w-11/12 max-w-sm transition-all duration-300 border-2 border-secondary-glow/30 text-center modal-card-centered scale-90" style="visibility: hidden;">
        <h2 class="text-3xl font-bold text-secondary-glow uppercase mb-6">WELCOME</h2>
        <button onclick="closeModal('getInChoiceModal'); openModal('loginModal')" class="w-full bg-secondary-glow text-dark-bg font-bold py-3 mb-4 rounded-lg hover:scale-[1.02] transition">LOG IN</button>
        <button onclick="closeModal('getInChoiceModal'); openModal('signupModal')" class="w-full bg-primary-neon text-dark-bg font-bold py-3 rounded-lg hover:scale-[1.02] transition">SIGN UP</button>
    </div>

    <div id="loginModal" class="glass-card rounded-2xl p-8 w-11/12 max-w-md transition-all duration-300 border-2 border-secondary-glow/30 modal-card-centered scale-90" style="visibility: hidden;">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-secondary-glow uppercase">ACCESS</h2>
            <button onclick="closeModal('loginModal')" class="text-gray-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>
        <form onsubmit="event.preventDefault(); handleUserAction('login')">
            <input type="text" id="login-username" class="w-full p-3 mb-4 rounded-lg bg-white/10 border border-secondary-glow/50 text-white" placeholder="Username/Email" required>
            <input type="password" id="login-password" class="w-full p-3 mb-6 rounded-lg bg-white/10 border border-secondary-glow/50 text-white" placeholder="Password" required>
            <button type="submit" class="w-full bg-secondary-glow text-dark-bg font-bold py-3 rounded-lg hover:scale-[1.02] transition">LOGIN</button>
        </form>
    </div>

    <div id="signupModal" class="glass-card rounded-2xl p-8 w-11/12 max-w-md transition-all duration-300 border-2 border-primary-neon/30 modal-card-centered scale-90" style="visibility: hidden;">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-primary-neon uppercase">CREATE</h2>
            <button onclick="closeModal('signupModal')" class="text-gray-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>
        <form onsubmit="event.preventDefault(); handleUserAction('signup')">
            <input type="text" id="signup-username" class="w-full p-3 mb-4 rounded-lg bg-white/10 border border-primary-neon/50 text-white" placeholder="Username" required>
            <input type="password" id="signup-password" class="w-full p-3 mb-6 rounded-lg bg-white/10 border border-primary-neon/50 text-white" placeholder="Password" required>
            <button type="submit" class="w-full bg-primary-neon text-dark-bg font-bold py-3 rounded-lg hover:scale-[1.02] transition">REGISTER</button>
        </form>
    </div>

    <script>
        // *** CONFIGURATION ***
        const GOOGLE_SHEET_API_URL = 'https://script.google.com/macros/s/AKfycbxHKM0oYLwtg8egGXcxOHbK9LNQ0KylGi4LaNQMaB37jrtDEZSVqjDhePgo5p3IIUjguw/exec'; 

        // State
        let allGameData = [];
        let activeTab = 'player';
        let siteConfig = { siteName: "", siteLink: "#" };
        let userIsAdmin = false;

        // Mock Data
        const mockGamesData = [
            { gameName: "Loading...", gameImageUrl: "https://placehold.co/400x400/1e3a8a/ffffff?text=Loading", playerUrl: "#", agentUrl: "#", visibility: "TRUE" },
            { gameName: "Loading...", gameImageUrl: "https://placehold.co/400x400/4c0519/ffffff?text=Loading", playerUrl: "#", agentUrl: "#", visibility: "TRUE" },
            { gameName: "Loading...", gameImageUrl: "https://placehold.co/400x400/065f46/ffffff?text=Loading", playerUrl: "#", agentUrl: "#", visibility: "TRUE" }
        ];

        // *** DATA NORMALIZER ***
        function normalizeGameData(rawGame) {
            return {
                gameName: rawGame.gameName || rawGame["Game Name"] || "Untitled",
                gameImageUrl: rawGame.gameImageUrl || rawGame["Game Image URL"] || "",
                playerUrl: rawGame.playerUrl || rawGame["Player URL"] || "#",
                agentUrl: rawGame.agentUrl || rawGame["Agent URL"] || "#",
                visibility: String(rawGame.visibility || rawGame["Visibility"] || "TRUE").toUpperCase()
            };
        }

        // *** 1. CORE RENDER FUNCTIONS ***

        window.setActiveTab = function(tabName) {
            activeTab = tabName;
            const pTab = document.getElementById('tab-player');
            const aTab = document.getElementById('tab-agent');
            if (pTab && aTab) {
                pTab.classList.remove('active');
                aTab.classList.remove('active');
                document.getElementById(`tab-${tabName}`).classList.add('active');
            }
            renderGameCards(allGameData);
        };

        window.renderGameCards = function(games) {
            const gameGrid = document.getElementById('gameGrid');
            if (!gameGrid) return; 
            
            gameGrid.innerHTML = ''; 

            if (games.length === 0) {
                gameGrid.innerHTML = '<p class="text-center col-span-full text-gray-400">No games available.</p>';
                return;
            }

            games.forEach(game => {
                const card = document.createElement('div');
                card.className = 'glass-card rounded-xl cursor-pointer group flex flex-col justify-between'; 
                card.onclick = () => openGame(game); 

                const imgContainer = document.createElement('div');
                imgContainer.className = 'w-full flex justify-center items-center h-28 sm:h-36 overflow-hidden'; 

                const img = document.createElement('img');
                img.src = game.gameImageUrl;
                img.alt = game.gameName;
                img.className = 'w-full h-full object-cover transition duration-300 transform group-hover:scale-[1.05]'; 
                img.onerror = function() { this.src='https://placehold.co/400x400/1f2937/ffffff?text=Missing'; };

                const content = document.createElement('div');
                content.className = 'px-1 py-1 text-center'; 

                const name = document.createElement('h3');
                name.textContent = game.gameName;
                name.className = 'game-title-pop font-medium transition duration-200'; 
                
                content.appendChild(name);
                imgContainer.appendChild(img);
                card.appendChild(imgContainer); 
                card.appendChild(content); 
                gameGrid.appendChild(card);
            });
        };

        window.openGame = function(game) {
            let url = (activeTab === 'player') ? game.playerUrl : game.agentUrl;
            if (url && url.trim() !== '#' && url.trim() !== '') {
                window.open(url, '_blank');
            } else {
                alert(`No ${activeTab} link available for ${game.gameName}.`);
            }
        };

        // *** 2. PAGE RENDERERS ***

        window.renderHomePage = function() {
            const mainContentDiv = document.getElementById('mainContent');
            mainContentDiv.innerHTML = `
                <h2 class="text-3xl font-bold mb-8 text-white uppercase tracking-wide border-b border-secondary-glow/50 pb-2 hidden sm:block">Featured Games</h2>
                <div class="flex justify-center mb-8 border-b border-white/10">
                    <div class="flex space-x-4">
                        <div id="tab-player" class="tab-button" onclick="setActiveTab('player')">Player Link</div>
                        <div id="tab-agent" class="tab-button" onclick="setActiveTab('agent')">Agent Link</div>
                    </div>
                </div>
                <div id="gameGrid" class="grid grid-cols-3 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-6"></div>
            `;
            setActiveTab(activeTab);
        };

        window.renderAdminPage = function() {
            const mainContentDiv = document.getElementById('mainContent');
            mainContentDiv.innerHTML = `
                <div class="glass-card rounded-xl p-6 mb-8 text-center">
                    <h2 class="text-3xl font-bold text-secondary-glow uppercase mb-4">Admin Config</h2>
                    <p>Site Name: <strong>${siteConfig.siteName}</strong></p>
                    <p>Total Games Loaded: ${allGameData.length}</p>
                </div>
            `;
        };

        window.navigateTo = function(page) {
            const mainContentDiv = document.getElementById('mainContent');
            mainContentDiv.innerHTML = '';
            
            closeModal('getInChoiceModal'); 
            closeModal('loginModal');
            closeModal('signupModal');

            const footer = document.querySelector('footer');

            if (page === 'home') {
                renderHomePage();
                footer.style.display = 'block';
            } else if (page === 'admin') {
                renderAdminPage();
                footer.style.display = 'none';
            }
        };

        // *** 3. DATA FETCHING (JSONP CALLBACK) ***

        window.handleGamesData = function(response) {
            console.log("Full API Response:", response);
            
            if (response.config) {
                const title = document.getElementById('siteTitle');
                if (title && response.config.siteName) {
                    title.textContent = response.config.siteName.toUpperCase();
                    document.title = response.config.siteName;
                    siteConfig = response.config;
                    document.getElementById("footer-copy").innerHTML = "&copy; 2025@"+`${siteConfig.siteName}`+".com";
                }
            }

            let rawData = [];
            if (Array.isArray(response)) {
                rawData = response;
            } else if (response.games && Array.isArray(response.games)) {
                rawData = response.games;
            }

            if (rawData.length > 0) {
                allGameData = rawData.map(normalizeGameData).filter(g => 
                    g.gameName && 
                    g.gameName !== 'Untitled' &&
                    g.visibility === 'TRUE'
                );
            } else {
                allGameData = mockGamesData;
            }
            
            navigateTo('home');
        };

        function fetchGamesFromGoogleSheet() {
            navigateTo('home');
            const script = document.createElement('script');
            script.src = `${GOOGLE_SHEET_API_URL}?callback=handleGamesData`;
            script.onerror = () => {
                console.error("JSONP Script failed to load.");
            };
            document.head.appendChild(script);
        }

        // *** 4. MODALS & AUTH ***

        window.openModal = function(id) {
            // document.body.classList.add('overflow-hidden');
            // const m = document.getElementById(id);
            // const b = document.getElementById('modalBackdrop');
            // if(m && b) {
            //     m.style.visibility = 'visible';
            //     m.classList.remove('scale-90'); m.classList.add('scale-100');
            //     b.classList.add('open');
            // }
            window.location.href = "login.html";
        };

        window.closeModal = function(id) {
            document.body.classList.remove('overflow-hidden');
            const m = document.getElementById(id);
            const b = document.getElementById('modalBackdrop');
            if(m && b) {
                m.classList.remove('scale-100'); m.classList.add('scale-90');
                b.classList.remove('open');
                setTimeout(() => { m.style.visibility = 'hidden'; }, 300);
            }
        };

        window.handleGetIn = function() { openModal('getInChoiceModal'); };
        
        window.handleUserAction = function(type) {
            const user = document.getElementById(type + '-username').value;
            
            // SIMULATE LOGIN: Set LocalStorage
            localStorage.setItem('Username', user);
            localStorage.setItem('LoggedIn', 'true');

            if (type === 'login' && user.toLowerCase() === 'admin') {
                userIsAdmin = true;
                document.getElementById('adminBtn').classList.remove('hidden');
            }
            
            closeModal(type + 'Modal');
            
            // Refresh User Session UI
            checkUserSession();
            navigateTo('home');
        };

        // *** 5. USER SESSION MANAGEMENT ***

        window.checkUserSession = function() {
            // Check LocalStorage keys
            const username = localStorage.getItem('Username');
            const loggedIn = localStorage.getItem('LoggedIn');
            
            const getInBtn = document.getElementById('getInBtn');
            const userProfile = document.getElementById('userProfile');
            const displayUsername = document.getElementById('displayUsername');

            if (loggedIn === 'true' && username) {
                // User is logged in
                if(getInBtn) getInBtn.classList.add('hidden');
                if(userProfile) userProfile.classList.remove('hidden');
                if(displayUsername) displayUsername.textContent = username;
            } else {
                // User is NOT logged in
                if(getInBtn) getInBtn.classList.remove('hidden');
                if(userProfile) userProfile.classList.add('hidden');
            }
        };

        window.toggleLogoutMenu = function() {
            const menu = document.getElementById('logoutMenu');
            if (menu) {
                menu.classList.toggle('hidden');
            }
        };

        window.handleLogout = function(event) {
            if(event) event.stopPropagation(); // Prevent bubbling
            
            // Clear all local storage
            localStorage.clear();
            
            // Hide menu and re-check session
            document.getElementById('logoutMenu').classList.add('hidden');
            checkUserSession();
            navigateTo('home');
        };
        
        // Close logout menu when clicking outside
        document.addEventListener('click', function(event) {
            const userProfile = document.getElementById('userProfile');
            const logoutMenu = document.getElementById('logoutMenu');
            // If click is outside userProfile div, close menu
            if (userProfile && !userProfile.contains(event.target)) {
                if(logoutMenu) logoutMenu.classList.add('hidden');
            }
        });

        // *** 6. INIT ***
        
        document.getElementById('modalBackdrop').addEventListener('click', () => {
            closeModal('getInChoiceModal'); closeModal('loginModal'); closeModal('signupModal');
        });

        document.addEventListener('DOMContentLoaded', () => {
            checkUserSession(); // Check login status immediately
            fetchGamesFromGoogleSheet();
        });

    </script>
</body>
</html>